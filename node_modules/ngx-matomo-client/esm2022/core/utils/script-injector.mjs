import { DOCUMENT } from '@angular/common';
import { inject, Injectable, INJECTOR, runInInjectionContext } from '@angular/core';
import { MATOMO_SCRIPT_FACTORY } from '../tracker/script-factory';
import { requireNonNull } from './coercion';
import * as i0 from "@angular/core";
export class ScriptInjector {
    constructor() {
        this.scriptFactory = inject(MATOMO_SCRIPT_FACTORY);
        this.injector = inject(INJECTOR);
        this.document = inject(DOCUMENT);
    }
    injectDOMScript(scriptUrl) {
        const scriptElement = runInInjectionContext(this.injector, () => this.scriptFactory(scriptUrl, this.document));
        const selfScript = requireNonNull(this.document.getElementsByTagName('script')[0], 'no existing script found');
        const parent = requireNonNull(selfScript.parentNode, "no script's parent node found");
        parent.insertBefore(scriptElement, selfScript);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: ScriptInjector, deps: [], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: ScriptInjector, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: ScriptInjector, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyaXB0LWluamVjdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LW1hdG9tby1jbGllbnQvY29yZS91dGlscy9zY3JpcHQtaW5qZWN0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRixPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDOztBQUc1QyxNQUFNLE9BQU8sY0FBYztJQUQzQjtRQUVtQixrQkFBYSxHQUFHLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQzlDLGFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUIsYUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztLQWM5QztJQVpDLGVBQWUsQ0FBQyxTQUFpQjtRQUMvQixNQUFNLGFBQWEsR0FBRyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUM5RCxJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQzdDLENBQUM7UUFDRixNQUFNLFVBQVUsR0FBRyxjQUFjLENBQy9CLElBQUksQ0FBQyxRQUFRLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQy9DLDBCQUEwQixDQUMzQixDQUFDO1FBQ0YsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFVBQVUsQ0FBQyxVQUFVLEVBQUUsK0JBQStCLENBQUMsQ0FBQztRQUV0RixNQUFNLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNqRCxDQUFDOzhHQWhCVSxjQUFjO2tIQUFkLGNBQWMsY0FERCxNQUFNOzsyRkFDbkIsY0FBYztrQkFEMUIsVUFBVTttQkFBQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBpbmplY3QsIEluamVjdGFibGUsIElOSkVDVE9SLCBydW5JbkluamVjdGlvbkNvbnRleHQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1BVE9NT19TQ1JJUFRfRkFDVE9SWSB9IGZyb20gJy4uL3RyYWNrZXIvc2NyaXB0LWZhY3RvcnknO1xuaW1wb3J0IHsgcmVxdWlyZU5vbk51bGwgfSBmcm9tICcuL2NvZXJjaW9uJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBTY3JpcHRJbmplY3RvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgc2NyaXB0RmFjdG9yeSA9IGluamVjdChNQVRPTU9fU0NSSVBUX0ZBQ1RPUlkpO1xuICBwcml2YXRlIHJlYWRvbmx5IGluamVjdG9yID0gaW5qZWN0KElOSkVDVE9SKTtcbiAgcHJpdmF0ZSByZWFkb25seSBkb2N1bWVudCA9IGluamVjdChET0NVTUVOVCk7XG5cbiAgaW5qZWN0RE9NU2NyaXB0KHNjcmlwdFVybDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3Qgc2NyaXB0RWxlbWVudCA9IHJ1bkluSW5qZWN0aW9uQ29udGV4dCh0aGlzLmluamVjdG9yLCAoKSA9PlxuICAgICAgdGhpcy5zY3JpcHRGYWN0b3J5KHNjcmlwdFVybCwgdGhpcy5kb2N1bWVudCksXG4gICAgKTtcbiAgICBjb25zdCBzZWxmU2NyaXB0ID0gcmVxdWlyZU5vbk51bGwoXG4gICAgICB0aGlzLmRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKVswXSxcbiAgICAgICdubyBleGlzdGluZyBzY3JpcHQgZm91bmQnLFxuICAgICk7XG4gICAgY29uc3QgcGFyZW50ID0gcmVxdWlyZU5vbk51bGwoc2VsZlNjcmlwdC5wYXJlbnROb2RlLCBcIm5vIHNjcmlwdCdzIHBhcmVudCBub2RlIGZvdW5kXCIpO1xuXG4gICAgcGFyZW50Lmluc2VydEJlZm9yZShzY3JpcHRFbGVtZW50LCBzZWxmU2NyaXB0KTtcbiAgfVxufVxuIl19