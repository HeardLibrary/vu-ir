import { APP_BASE_HREF, LocationStrategy } from '@angular/common';
import { inject, InjectionToken } from '@angular/core';
import { of } from 'rxjs';
import { INTERNAL_ROUTER_CONFIGURATION } from './configuration';
export const MATOMO_PAGE_URL_PROVIDER = new InjectionToken('MATOMO_PAGE_URL_PROVIDER', {
    factory: () => new DefaultPageUrlProvider(inject(INTERNAL_ROUTER_CONFIGURATION), inject(APP_BASE_HREF, { optional: true }), inject(LocationStrategy)),
});
function trimTrailingSlash(str) {
    return str.endsWith('/') ? str.slice(0, -1) : str;
}
export class DefaultPageUrlProvider {
    constructor(config, baseHref, locationStrategy) {
        this.config = config;
        this.baseHref = baseHref;
        this.locationStrategy = locationStrategy;
    }
    getCurrentPageUrl(event) {
        const url = this.config.prependBaseHref
            ? this.getBaseHrefWithoutTrailingSlash() + event.urlAfterRedirects
            : event.urlAfterRedirects;
        return of(url);
    }
    getBaseHrefWithoutTrailingSlash() {
        return trimTrailingSlash(this.baseHref ?? this.locationStrategy.getBaseHref() ?? '');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS11cmwtcHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtbWF0b21vLWNsaWVudC9yb3V0ZXIvcGFnZS11cmwtcHJvdmlkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRXZELE9BQU8sRUFBYyxFQUFFLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdEMsT0FBTyxFQUFFLDZCQUE2QixFQUErQixNQUFNLGlCQUFpQixDQUFDO0FBRTdGLE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHLElBQUksY0FBYyxDQUN4RCwwQkFBMEIsRUFDMUI7SUFDRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQ1osSUFBSSxzQkFBc0IsQ0FDeEIsTUFBTSxDQUFDLDZCQUE2QixDQUFDLEVBQ3JDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFDekMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQ3pCO0NBQ0osQ0FDRixDQUFDO0FBTUYsU0FBUyxpQkFBaUIsQ0FBQyxHQUFXO0lBQ3BDLE9BQU8sR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO0FBQ3BELENBQUM7QUFFRCxNQUFNLE9BQU8sc0JBQXNCO0lBQ2pDLFlBQ21CLE1BQW1DLEVBQ25DLFFBQXVCLEVBQ3ZCLGdCQUFrQztRQUZsQyxXQUFNLEdBQU4sTUFBTSxDQUE2QjtRQUNuQyxhQUFRLEdBQVIsUUFBUSxDQUFlO1FBQ3ZCLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7SUFDbEQsQ0FBQztJQUVKLGlCQUFpQixDQUFDLEtBQW9CO1FBQ3BDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZTtZQUNyQyxDQUFDLENBQUMsSUFBSSxDQUFDLCtCQUErQixFQUFFLEdBQUcsS0FBSyxDQUFDLGlCQUFpQjtZQUNsRSxDQUFDLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDO1FBRTVCLE9BQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFFTywrQkFBK0I7UUFDckMsT0FBTyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN2RixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBUFBfQkFTRV9IUkVGLCBMb2NhdGlvblN0cmF0ZWd5IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IGluamVjdCwgSW5qZWN0aW9uVG9rZW4gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5hdmlnYXRpb25FbmQgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElOVEVSTkFMX1JPVVRFUl9DT05GSUdVUkFUSU9OLCBJbnRlcm5hbFJvdXRlckNvbmZpZ3VyYXRpb24gfSBmcm9tICcuL2NvbmZpZ3VyYXRpb24nO1xuXG5leHBvcnQgY29uc3QgTUFUT01PX1BBR0VfVVJMX1BST1ZJREVSID0gbmV3IEluamVjdGlvblRva2VuPFBhZ2VVcmxQcm92aWRlcj4oXG4gICdNQVRPTU9fUEFHRV9VUkxfUFJPVklERVInLFxuICB7XG4gICAgZmFjdG9yeTogKCkgPT5cbiAgICAgIG5ldyBEZWZhdWx0UGFnZVVybFByb3ZpZGVyKFxuICAgICAgICBpbmplY3QoSU5URVJOQUxfUk9VVEVSX0NPTkZJR1VSQVRJT04pLFxuICAgICAgICBpbmplY3QoQVBQX0JBU0VfSFJFRiwgeyBvcHRpb25hbDogdHJ1ZSB9KSxcbiAgICAgICAgaW5qZWN0KExvY2F0aW9uU3RyYXRlZ3kpLFxuICAgICAgKSxcbiAgfSxcbik7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFnZVVybFByb3ZpZGVyIHtcbiAgZ2V0Q3VycmVudFBhZ2VVcmwoZXZlbnQ6IE5hdmlnYXRpb25FbmQpOiBPYnNlcnZhYmxlPHN0cmluZz47XG59XG5cbmZ1bmN0aW9uIHRyaW1UcmFpbGluZ1NsYXNoKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHN0ci5lbmRzV2l0aCgnLycpID8gc3RyLnNsaWNlKDAsIC0xKSA6IHN0cjtcbn1cblxuZXhwb3J0IGNsYXNzIERlZmF1bHRQYWdlVXJsUHJvdmlkZXIgaW1wbGVtZW50cyBQYWdlVXJsUHJvdmlkZXIge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogSW50ZXJuYWxSb3V0ZXJDb25maWd1cmF0aW9uLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgYmFzZUhyZWY6IHN0cmluZyB8IG51bGwsXG4gICAgcHJpdmF0ZSByZWFkb25seSBsb2NhdGlvblN0cmF0ZWd5OiBMb2NhdGlvblN0cmF0ZWd5LFxuICApIHt9XG5cbiAgZ2V0Q3VycmVudFBhZ2VVcmwoZXZlbnQ6IE5hdmlnYXRpb25FbmQpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIGNvbnN0IHVybCA9IHRoaXMuY29uZmlnLnByZXBlbmRCYXNlSHJlZlxuICAgICAgPyB0aGlzLmdldEJhc2VIcmVmV2l0aG91dFRyYWlsaW5nU2xhc2goKSArIGV2ZW50LnVybEFmdGVyUmVkaXJlY3RzXG4gICAgICA6IGV2ZW50LnVybEFmdGVyUmVkaXJlY3RzO1xuXG4gICAgcmV0dXJuIG9mKHVybCk7XG4gIH1cblxuICBwcml2YXRlIGdldEJhc2VIcmVmV2l0aG91dFRyYWlsaW5nU2xhc2goKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdHJpbVRyYWlsaW5nU2xhc2godGhpcy5iYXNlSHJlZiA/PyB0aGlzLmxvY2F0aW9uU3RyYXRlZ3kuZ2V0QmFzZUhyZWYoKSA/PyAnJyk7XG4gIH1cbn1cbiJdfQ==